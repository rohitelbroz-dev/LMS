{% if active_targets and session.get('hide_targets_banner_' + current_user.id|string) != date_today %}
<div class="targets-topbar alert alert-gradient border-0 mb-4 fade-in-up" id="targetsTopbar">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">
            <i class="fas fa-bullseye me-2"></i>Your Active Targets
            <span class="badge bg-primary ms-2">{{ active_targets|length }}</span>
        </h5>
        <button class="btn btn-sm btn-link text-white" onclick="dismissTargets()" title="Dismiss">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <div class="row g-3">
        {% for item in active_targets %}
        <div class="col-md-{{ '12' if active_targets|length == 1 else '6' if active_targets|length == 2 else '4' }}">
            <div class="card h-100 target-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <h6 class="mb-1">
                                <span class="badge bg-secondary">{{ item.target.target_type|capitalize }}</span>
                            </h6>
                            <small class="text-muted">
                                <i class="fas fa-calendar me-1"></i>{{ item.target.period_start }} to {{ item.target.period_end }}
                            </small>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="fw-bold">Goal: {{ item.target.target_count }} leads</span>
                            <span class="text-muted">{{ item.progress.actual }}/{{ item.target.target_count }}</span>
                        </div>
                        <div class="progress" style="height: 24px;">
                            <div class="progress-bar {% if item.progress.percent >= 80 %}bg-success{% elif item.progress.percent >= 50 %}bg-warning{% else %}bg-danger{% endif %}" 
                                 role="progressbar" 
                                 style="width: {{ item.progress.percent|round|int }}%"
                                 aria-valuenow="{{ item.progress.actual }}" 
                                 aria-valuemin="0" 
                                 aria-valuemax="{{ item.target.target_count }}">
                                <strong>{{ item.progress.percent|round|int }}%</strong>
                            </div>
                        </div>
                    </div>
                    
                    {% if item.days_left is defined %}
                    <div class="mt-2">
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>{{ item.days_left }} day{{ 's' if item.days_left != 1 else '' }} remaining
                        </small>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div class="text-center mt-3">
        <a href="{{ url_for('manage_targets') }}" class="btn btn-sm btn-light">
            <i class="fas fa-chart-line me-2"></i>View All Targets
        </a>
    </div>
</div>

<script>
function dismissTargets() {
    document.getElementById('targetsTopbar').style.display = 'none';
    fetch('{{ url_for("dismiss_targets_banner") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    });
}
</script>
{% endif %}
