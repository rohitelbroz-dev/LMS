{% extends "base.html" %}

{% block title %}Assign to BD Sales - {{ lead['company'] }}{% endblock %}

{% block authenticated_content %}
<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3 fade-in-up">
    <h1 class="page-title">
        <i class="fas fa-user-tie me-2"></i>Assign to BD Sales
        <span class="text-muted fs-5 ms-2 d-none d-md-inline">{{ lead['company'] }}</span>
    </h1>
    <a href="{{ url_for('view_lead', lead_id=lead['id']) }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-1"></i>
        <span class="d-none d-sm-inline">Back to Lead</span>
        <span class="d-inline d-sm-none">Back</span>
    </a>
</div>

<!-- 2-Column Layout: Lead Details & Assignment Details -->
<div class="row mb-4">
    <!-- Lead Details - Left Column -->
    <div class="col-12 col-md-6 mb-4 mb-md-0">
        <div class="card shadow-sm h-100">
            <div class="card-header" style="background: linear-gradient(135deg, #e76ba6 0%, #a855f7 50%, #60a5fa 100%);">
                <h5 class="mb-0 text-white">
                    <i class="fas fa-info-circle me-2"></i>Lead Details
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-12">
                        <div class="p-3 rounded" style="background: linear-gradient(135deg, rgba(231, 107, 166, 0.1) 0%, rgba(168, 85, 247, 0.05) 100%); border-left: 3px solid #e76ba6;">
                            <strong class="text-muted d-block small mb-1">Company</strong>
                            <span class="fw-bold" style="color: #1f2937;">{{ lead['company'] }}</span>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6">
                        <strong class="text-muted d-block small mb-1">Contact Name</strong>
                        <span>{{ lead['full_name'] }}</span>
                    </div>
                    <div class="col-12 col-sm-6">
                        <strong class="text-muted d-block small mb-1">Phone</strong>
                        <span>{{ lead['phone'] }}</span>
                    </div>
                    <div class="col-12 col-sm-6">
                        <strong class="text-muted d-block small mb-1">Email</strong>
                        <span class="text-break">{{ lead['email'] }}</span>
                    </div>
                    <div class="col-12 col-sm-6">
                        <strong class="text-muted d-block small mb-1">Domain</strong>
                        <span class="text-break">{{ lead['domain'] }}</span>
                    </div>
                    <div class="col-12 col-sm-6">
                        <strong class="text-muted d-block small mb-1">Status</strong>
                        <span class="badge bg-success px-3 py-2">
                            <i class="fas fa-check-circle me-1"></i>Accepted
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Assignment Details - Right Column -->
    <div class="col-12 col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header" style="background: linear-gradient(135deg, #e76ba6 0%, #a855f7 50%, #60a5fa 100%);">
                <h5 class="mb-0 text-white">
                    <i class="fas fa-paper-plane me-2"></i>Assignment Details
                </h5>
            </div>
            <div class="card-body">
                <form method="POST" novalidate>
                    {{ form.hidden_tag() }}
                    
                    <div class="mb-4">
                        {{ form.bd_sales_id.label(class="form-label fw-bold") }}
                        <div class="small text-muted mb-2">
                            <i class="fas fa-sync-alt me-1"></i> Auto-suggested based on round-robin distribution
                        </div>
                        {{ form.bd_sales_id(class="form-select form-select-lg") }}
                        {% if form.bd_sales_id.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.bd_sales_id.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="mb-4">
                        {{ form.note.label(class="form-label fw-bold") }}
                        {{ form.note(class="form-control", rows=3, placeholder="Add any special instructions or context for the BD Sales rep...") }}
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>This note will be visible in the lead activity timeline
                        </div>
                        {% if form.note.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.note.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-lg" style="background: linear-gradient(135deg, #e76ba6 0%, #a855f7 50%, #60a5fa 100%); border: none; color: white; font-weight: 600;">
                            <i class="fas fa-paper-plane me-2"></i>Assign to BD Sales
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Full Width: Available BD Sales Team -->
<div class="card shadow-sm">
    <div class="card-header" style="background: linear-gradient(135deg, #e76ba6 0%, #a855f7 50%, #60a5fa 100%);">
        <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0 text-white">
                <i class="fas fa-users me-2"></i>Available BD Sales Team
            </h5>
            <span class="badge bg-white text-dark px-3 py-2">
                <strong>{{ bd_sales_users|length }}</strong> Members
            </span>
        </div>
    </div>
    <div class="card-body" style="background: linear-gradient(to bottom, rgba(231, 107, 166, 0.02) 0%, rgba(255, 255, 255, 1) 100%);">
        <div class="row g-3">
            {% for bd_user in bd_sales_users %}
            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                <div class="bd-card p-3 border rounded h-100 d-flex flex-column align-items-center text-center">
                    <div class="position-relative mb-3">
                        <img src="{{ get_avatar_url(bd_user['id']) }}" 
                             alt="{{ bd_user['name'] }}" 
                             class="rounded-circle" 
                             style="width: 70px; height: 70px; object-fit: cover; border: 3px solid #a855f7; box-shadow: 0 4px 6px rgba(168, 85, 247, 0.2);">
                        <div class="position-absolute bottom-0 end-0 bg-success rounded-circle" style="width: 18px; height: 18px; border: 2px solid white;"></div>
                    </div>
                    <strong class="d-block mb-1" style="color: #1f2937; font-size: 0.95rem;">{{ bd_user['name'] }}</strong>
                    <small class="text-muted text-truncate w-100" style="font-size: 0.8rem;">{{ bd_user['email'] }}</small>
                    <div class="mt-auto pt-2">
                        <span class="badge bg-light text-muted border" style="font-size: 0.7rem;">
                            <i class="fas fa-user-tie me-1"></i>BD Sales
                        </span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<style>
.bd-card {
    transition: all 0.3s ease;
    background: white;
}
.bd-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(168, 85, 247, 0.15);
    border-color: #a855f7 !important;
}
</style>
{% endblock %}
